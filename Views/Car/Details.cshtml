@model HonestAuto.Models.CarViewModel

@{
    ViewData["Title"] = "Car Details";
    var referrerId = ViewData["ReferrerId"] as int?;
    var currentUserId = ViewData["CurrentUserId"] as string;
}

<!DOCTYPE html>
<html data-bs-theme="light">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Car Details</title>
    <link rel="stylesheet" href="~/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700&amp;display=swap">
    <link rel="stylesheet" href="~/css/pikaday.min.css">
</head>

<body>
    <main class="page contact-page">
        <section class="portfolio-block contact">
            <div class="container">
                <div class="heading">
                    <h2>Car Details&nbsp;</h2>
                </div>
                <form class="shadow-lg" data-bs-theme="light">
                    <div>
                        <p><strong>User:</strong> @Model.UserEmail</p>
                        <p><strong>Brand:</strong> @Model.BrandName</p>
                        <p><strong>Model:</strong> @Model.ModelName</p>
                        @if (Model.CarImage != null && Model.CarImage.Length > 0)
                        {
                            <img src="data:image/jpeg;base64,@Convert.ToBase64String(Model.CarImage)" style="width:400px; height:auto;" />
                        }
                        else
                        {
                            <p><strong>No Image</strong></p>
                        }
                        <p><strong>Year:</strong> @Model.Year</p>
                        <p><strong>Mileage:</strong> @Model.Mileage</p>
                        <p><strong>History:</strong> @Model.History</p>
                        <p><strong>Price:</strong> @($"{Model.CarValue:C}")</p>



                    </div>
                    <div>
                        <div>
                            @if (referrerId.HasValue && referrerId.Value != 0)
                            {
                                <!-- Button to go back to the specific CarEvaluation -->
                                <a asp-controller="CarEvaluation" asp-action="Details" asp-route-id="@referrerId.Value" class="btn btn-secondary">Back to Car Evaluation</a>
                            }
                            else
                            {
                                @if (User.IsInRole("Buyer"))
                                {
                                    <!-- Button to message the user -->
                       <!-- Button to message the user -->
                                    <button type="button" class="btn btn-info" onclick="location.href='@Url.Action("ChatWithUser", "Chat", new { receiverId = Model.UserID })'">Message User</button>


                                    <!-- Button to view seller's profile -->
                                    <div>
                                        <a asp-controller="User" asp-action="Details" asp-route-id="@Model.UserID" class="btn btn-info">View Seller's Profile</a>
                                    </div>
                                }

                                @if (User.Identity.Name == Model.UserID)
                                {
                                    <!-- Button to edit the car -->
                                    <a asp-action="Edit" asp-route-id="@Model.CarID" class="btn btn-warning">Edit</a>
                                }

                          
                            }

                            <!-- Button to view car evaluation details -->
                            <a asp-controller="CarEvaluation" asp-action="Details" asp-route-id="@Model.CarEvaluationID" class="btn btn-primary">View Car Evaluation</a>

                            <!-- Button to edit the car (only available if the current user matches the car's UserID) -->
                            @if (User.Identity.IsAuthenticated && Model.UserID == currentUserId)
                            {
                                <!-- Display the "Edit" button if the current user owns the car -->
                                <a asp-action="Edit" asp-route-id="@Model.CarID" class="btn btn-warning">Edit</a>
                            }
                        </div>


             
                    </div>
                </form>
            </div>
        </section>
    </main>

    <script src="~/bootstrap/js/bootstrap.min.js"></script>
    <script src="~/js/pikaday.min.js"></script>
    <script src="~/js/theme.js"></script>
</body>

</html>
